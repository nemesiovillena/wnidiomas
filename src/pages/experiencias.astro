---
import MainLayout from '../layouts/MainLayout.astro';
import Section from '../components/ui/Section.astro';
import Container from '../components/ui/Container.astro';
import { getSiteSettings, getPaginaBySlug } from '../lib/payload-local';

const siteSettings = await getSiteSettings();
const pageData = await getPaginaBySlug('experiencias');

const pageTitle = pageData?.metaTitle || `Experiencias | ${siteSettings?.title || "Warynessy"}`;
const pageDescription = pageData?.metaDescription || "Regala una experiencia gastronómica inolvidable en Warynessy.";

// Imagen Hero desde el CMS o fallback
const heroImg = typeof pageData?.heroImage === 'object' && pageData?.heroImage?.url
  ? pageData.heroImage.url
  : 'https://images.unsplash.com/photo-1559339352-11d035aa65de?auto=format&fit=crop&q=80';
---

<MainLayout title={pageTitle} description={pageDescription} noPaddingTop={true}>
  {/* Hero Section */}
  <section class="relative pt-32 pb-12 md:pt-48 md:pb-16 bg-matte-black overflow-hidden">
    <div class="absolute inset-0 bg-cover bg-center opacity-30" style={`background-image: url('${heroImg}')`}></div>
    <div class="absolute inset-0 bg-gradient-to-t from-matte-black to-transparent"></div>
    <Container class="relative z-10 text-center animate-fade-up">
      <span class="text-primary font-bold tracking-[0.3em] uppercase text-sm mb-4 block">
        {pageData?.heroSubtitle || "Regala Gastronomía"}
      </span>
      <h1 class="text-5xl md:text-7xl font-display font-black text-white mb-6">
        {pageData?.heroTitle || "Experiencias Warynessy"}
      </h1>
      <p class="text-white/60 text-lg max-w-2xl mx-auto font-light">
        Elige uno de los Menús que te hemos preparado y sorprende a esa persona especial con una experiencia gastronómica inolvidable.
      </p>
    </Container>
  </section>

  <Section class="bg-matte-black pt-0">
    <Container class="w-full max-w-5xl -mt-8">
      {/* Widget de Covermanager para Experiencias */}
      <div class="bg-white rounded-2xl overflow-hidden shadow-2xl border border-white/5">
        <div id="covermanager-experiences-widget" class="w-full">
           <script is:inline src="https://www.covermanager.com/js/iframeResizer.min.js"></script>
           <iframe
             src="https://www.covermanager.com/eco/buy_products/restaurante-warynessy/spanish"
             style="width: 1px; min-width: 100%; min-height: 1000px; border: none;"
             id="restaurante-warynessy-experiencias"
             title="Comprar Tarjeta Regalo / Experiencias"
             allow="payment"
             scrolling="no"
           ></iframe>
           <script is:inline>
             // Función para inicializar el redimensionamiento
             function initIframeResize() {
               if (typeof iFrameResize === 'function') {
                 iFrameResize({
                   log: false,
                   checkOrigin: false,
                   heightCalculationMethod: 'max',
                   interval: 32,
                   resizedCallback: function(data) {
                     console.log('Iframe resized to: ' + data.height);
                   }
                 }, '#restaurante-warynessy-experiencias');
               }
             }

             // Ejecutar inmediatamente y en carga
             initIframeResize();
             window.addEventListener('load', initIframeResize);
             // Soporte para navegaciones de Astro si se habilitan en el futuro
             document.addEventListener('astro:page-load', initIframeResize);
           </script>
        </div>
      </div>

      {/* Instrucciones de canje */}
      <div class="mt-16 grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="p-8 bg-white/5 rounded-2xl border border-white/10">
          <h2 class="text-white font-serif text-xl font-bold mb-6 flex items-center gap-3">
            <span class="material-symbols-outlined text-primary">description</span>
            Cómo funciona
          </h2>
          <ul class="space-y-4 text-white/60 text-sm leading-relaxed">
            <li class="flex gap-3">
              <span class="text-primary font-bold">01.</span>
              <span>Selecciona el menú que quieres regalar entre nuestras opciones.</span>
            </li>
            <li class="flex gap-3">
              <span class="text-primary font-bold">02.</span>
              <span>Rellena los datos de la persona a la que se lo quieres enviar.</span>
            </li>
            <li class="flex gap-3">
              <span class="text-primary font-bold">03.</span>
              <span>Recibirán una tarjeta regalo con un código único para su reserva.</span>
            </li>
          </ul>
        </div>

        <div class="p-8 bg-white/5 rounded-2xl border border-white/10">
          <h2 class="text-white font-serif text-xl font-bold mb-6 flex items-center gap-3">
            <span class="material-symbols-outlined text-primary">confirmation_number</span>
            Cómo canjearla
          </h2>
          <div class="space-y-4 text-white/60 text-sm leading-relaxed">
            <p>Es imprescindible reservar con antelación indicando el código proporcionado en la tarjeta.</p>
            <div class="pt-4 border-t border-white/10 space-y-2">
              <p class="flex items-center gap-2"><span class="material-symbols-outlined text-xs text-primary">call</span> 96 580 10 47</p>
              <p class="flex items-center gap-2"><span class="material-symbols-outlined text-xs text-primary">chat</span> 619 73 77 70 (WhatsApp)</p>
            </div>
            <p class="text-xs text-white/40 italic mt-4">Validez de la tarjeta regalo: 3 meses desde la compra.</p>
          </div>
        </div>
      </div>
    </Container>
  </Section>
</MainLayout>
