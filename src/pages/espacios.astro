---
import MainLayout from '../layouts/MainLayout.astro';
import Section from '../components/ui/Section.astro';
import Container from '../components/ui/Container.astro';
import ResponsiveImage from '../components/ui/ResponsiveImage.astro';
import Button from '../components/ui/Button.astro';
import RichText from '../components/ui/RichText.astro';
import { getSiteSettings, getSpaces, getPaginaBySlug } from '../lib/payload-local';

const siteSettings = await getSiteSettings();
const pageData = await getPaginaBySlug('espacios');
const spaces = await getSpaces();

const pageTitle = pageData?.metaTitle || `Espacios | ${siteSettings?.title || "Restaurante Warynessy"}`;
const pageDescription = pageData?.metaDescription || "Descubre los espacios únicos y exclusivos de Restaurante Warynessy. Salones diseñados para experiencias gastronómicas memorables.";

// Imágenes para el layout Split-Screen desde Payload (Páginas -> Espacios)
const splitImages = [
  pageData?.imagenEspacio1,
  pageData?.imagenEspacio2,
  pageData?.imagenEspacio3,
  pageData?.imagenEspacio4,
].filter(Boolean);
---

<MainLayout title={pageTitle} description={pageDescription} noPaddingTop={true}>
  
  <div class="flex flex-col lg:flex-row min-h-screen bg-background-light dark:bg-zinc-900">
    
    <!-- Left Side: Sticky Images (Desktop) -->
    <aside class="w-full lg:w-1/2 lg:sticky lg:top-0 lg:h-screen bg-matte-black overflow-hidden z-0">
      <div class="grid grid-cols-2 h-full">
        {splitImages.length > 0 ? (
          splitImages.map((img: any, i: number) => (
            <div class="relative overflow-hidden group border-[0.5px] border-white/5">
              <img 
                src={img?.url || '/images/placeholder-space.jpg'} 
                alt={`Ambiente ${i + 1}`}
                class="w-full h-full object-cover grayscale opacity-60 group-hover:grayscale-0 group-hover:opacity-100 transition-all duration-1000 scale-110 group-hover:scale-100" 
              />
              <div class="absolute inset-0 bg-gradient-to-t from-matte-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            </div>
          ))
        ) : (
          // Fallback if no images are selected in Payload
          Array.from({ length: 4 }).map((_, i) => (
            <div class="bg-zinc-900 border border-white/5 flex flex-col items-center justify-center p-8 text-center group">
               <div class="w-12 h-px bg-primary/30 mb-4 group-hover:w-20 transition-all duration-700"></div>
               <span class="text-white/5 font-display text-7xl font-black mb-2 select-none group-hover:text-primary/10 transition-colors duration-700">W</span>
               <div class="w-12 h-px bg-primary/30 mt-4 group-hover:w-20 transition-all duration-700"></div>
            </div>
          ))
        )}
      </div>
    </aside>

    <!-- Right Side: Content (Scrollable) -->
    <main class="w-full lg:w-1/2 relative z-10 shadow-[-20px_0_50px_rgba(0,0,0,0.2)] bg-background-light dark:bg-zinc-900">
      
      <!-- Hero/Intro Section within Scroll -->
      <section class="pt-24 pb-12 px-8 md:px-16 animate-fade-up">
         <span class="text-primary font-bold tracking-[0.3em] uppercase text-xs mb-4 block">Nuestros Ambientes</span>
         <h1 class="text-5xl md:text-7xl font-display font-black text-warynessy-black dark:text-white mb-6 uppercase tracking-tighter">
           Espacios <span class="text-primary italic font-serif lowercase tracking-normal">únicos</span>
         </h1>
         <p class="text-gray-600 dark:text-gray-400 text-lg font-light leading-relaxed max-w-xl">
            Cada rincón de Warynessy ha sido diseñado para crear la atmósfera perfecta. Descubre donde la gastronomía se encuentra con el confort en un entorno incomparable.
         </p>
         <div class="mt-8 h-px w-24 bg-primary/30"></div>
      </section>

      <!-- Spaces List -->
      <div class="px-8 md:px-16 pb-32 flex flex-col gap-32">
        {spaces?.map((space: any, index: number) => {
          // La imagen principal será la primera de la galería si existe
          const imagenPrincipal = space.galeria?.[0]?.imagen;
          // El resto de la galería
          const restoGaleria = space.galeria?.slice(1, 4);

          return (
            <div class="flex flex-col gap-8 animate-fade-up" style={`animation-delay: ${index * 100}ms`}>
               <div class="flex items-center gap-4">
                 <span class="text-primary font-bold tracking-tighter text-4xl opacity-20">0{index + 1}</span>
                 <h2 class="text-3xl md:text-5xl font-display font-black text-warynessy-black dark:text-white uppercase tracking-tight">
                   {space.nombre}
                 </h2>
               </div>

               <div class="relative rounded-2xl overflow-hidden shadow-xl aspect-[16/9]">
                  <ResponsiveImage 
                    src={imagenPrincipal?.url || '/images/placeholder-space.jpg'} 
                    alt={space.nombre}
                    class="w-full h-full object-cover hover:scale-105 transition-transform duration-700"
                  />
                  {space.disponibleEventos && (
                    <div class="absolute top-4 right-4 z-20">
                      <span class="px-3 py-1 bg-primary text-white text-[10px] font-black uppercase tracking-widest rounded-full shadow-lg">
                        Ideal Eventos
                      </span>
                    </div>
                  )}
               </div>

               <div class="flex flex-col gap-6">
                  <RichText content={space.descripcion} class="text-gray-600 dark:text-gray-400 text-base leading-relaxed" />
                  
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {space.capacidad && (
                      <div class="p-4 rounded-xl bg-white dark:bg-zinc-800/50 border border-gray-100 dark:border-zinc-800 flex items-center gap-3">
                        <span class="material-symbols-outlined text-primary">groups</span>
                        <div>
                          <p class="text-[10px] uppercase tracking-widest text-gray-400 font-bold leading-none mb-1">Capacidad</p>
                          <p class="text-sm font-bold">{space.capacidad} personas</p>
                        </div>
                      </div>
                    )}
                    
                    {space.caracteristicas && space.caracteristicas.length > 0 && (
                      <div class="p-4 rounded-xl bg-white dark:bg-zinc-800/50 border border-gray-100 dark:border-zinc-800 flex flex-wrap gap-2">
                         {space.caracteristicas.map((item: any) => (
                           <span class="text-[10px] font-black uppercase tracking-tight text-gray-500">
                             • {item.caracteristica}
                           </span>
                         ))}
                      </div>
                    )}
                  </div>

                  <div class="flex gap-4">
                    <Button href="/reservas" variant="primary" class="flex-grow md:flex-none py-3 px-8 text-sm uppercase tracking-widest font-black">
                      Reservar en este salón
                    </Button>
                  </div>
               </div>

               {restoGaleria && restoGaleria.length > 0 && (
                 <div class="grid grid-cols-3 gap-4 mt-4">
                   {restoGaleria.map((item: any) => (
                     <div class="aspect-square rounded-xl overflow-hidden shadow-md border border-white/10">
                        <ResponsiveImage 
                          src={item.imagen?.url}
                          alt={space.nombre}
                          class="w-full h-full object-cover hover:scale-110 transition-transform duration-500"
                        />
                     </div>
                   ))}
                 </div>
               )}

               <div class="h-px bg-gradient-to-r from-primary/20 via-transparent to-transparent mt-8"></div>
            </div>
          );
        })}
      </div>
    </main>
  </div>

</MainLayout>

<style>
  /* Optimizaciones de scroll y sticky */
  @media (min-width: 1024px) {
    aside {
      height: 100vh;
      position: sticky;
      top: 0;
    }
  }
</style>


