---
import MainLayout from '../layouts/MainLayout.astro';
import Section from '../components/ui/Section.astro';
import Container from '../components/ui/Container.astro';
import MenuCard from '../components/content/MenuCard.astro';
import { getSiteSettings, getMenus, getPaginaBySlug } from '../lib/payload-local';

// Disable caching to always show fresh content from CMS
Astro.response.headers.set('Cache-Control', 'no-cache, no-store, must-revalidate');
Astro.response.headers.set('Pragma', 'no-cache');
Astro.response.headers.set('Expires', '0');

const siteSettings = await getSiteSettings();
const menus = await getMenus();
const pageData = await getPaginaBySlug('menus');

const pageTitle = pageData?.metaTitle || `Menús | ${siteSettings?.title || "Warynessy"}`;
const pageDescription = pageData?.metaDescription || "Descubre nuestros menús degustación y opciones especiales.";

// Imagen Hero desde el CMS o fallback
const heroImg = typeof pageData?.heroImage === 'object' && pageData?.heroImage?.url 
  ? pageData.heroImage.url 
  : 'https://images.unsplash.com/photo-1544148103-0773bf10d330?auto=format&fit=crop&q=80';
---

<MainLayout title={pageTitle} description={pageDescription} hideFloatingButton={true} noPaddingTop={true}>
    <section class="relative pt-32 pb-12 md:pt-48 md:pb-16 bg-matte-black overflow-hidden">
      <div class="absolute inset-0 bg-cover bg-center opacity-30" style={`background-image: url('${heroImg}')`}></div>
      <div class="absolute inset-0 bg-gradient-to-t from-matte-black via-matte-black/60 to-transparent"></div>
      <Container class="relative z-10 text-center animate-fade-up">
         <span class="text-primary font-black tracking-[0.3em] uppercase text-sm mb-4 block">
            Exclusividad
         </span>
         <h1 class="text-5xl md:text-7xl font-display font-black text-white mb-6 uppercase tracking-tight">
           Selección de Menús
         </h1>
         <p class="text-white/50 text-base md:text-lg max-w-2xl mx-auto font-medium">
           Experiencias culinarias diseñadas para cada momento
         </p>
      </Container>
   </section>

   <Section class="bg-matte-black min-h-screen pt-8 pb-16 md:pt-12 md:pb-24">
     <Container>
       {menus.length > 0 ? (
         <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 max-w-6xl mx-auto">
           {menus.map((menu: any) => (
              <MenuCard menu={menu} />
           ))}
         </div>
      ) : (
        <div class="text-center py-20">
          <p class="text-white/40 text-xl">Próximamente nuevos menús de temporada.</p>
        </div>
      )}
</Container>
  </Section>

</MainLayout>
