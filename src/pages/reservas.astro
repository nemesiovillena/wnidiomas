---
import MainLayout from '../layouts/MainLayout.astro';
import Section from '../components/ui/Section.astro';
import Container from '../components/ui/Container.astro';
import { getSiteSettings, getPaginaBySlug } from '../lib/payload-local';

const siteSettings = await getSiteSettings();
const pageData = await getPaginaBySlug('reservas');

const pageTitle = pageData?.metaTitle || `Reservas | ${siteSettings?.title || "Warynessy"}`;
const pageDescription = pageData?.metaDescription || "Reserva tu mesa en Warynessy de forma rápida y sencilla.";

// Imagen Hero desde el CMS o fallback
const heroImg = typeof pageData?.heroImage === 'object' && pageData?.heroImage?.url
  ? pageData.heroImage.url
  : 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?auto=format&fit=crop&q=80';
---

<MainLayout title={pageTitle} description={pageDescription} noPaddingTop={true}>
  {/* Hero Section */}
  <section class="relative pt-32 pb-24 md:pt-48 md:pb-32 bg-matte-black overflow-hidden">
    <div class="absolute inset-0 bg-cover bg-center opacity-30" style={`background-image: url('${heroImg}')`}></div>
    <div class="absolute inset-0 bg-gradient-to-t from-matte-black to-transparent"></div>
    <Container class="relative z-10 text-center animate-fade-up">
      <span class="text-primary font-bold tracking-[0.3em] uppercase text-sm mb-4 block">
        {pageData?.heroSubtitle || "Reservas"}
      </span>
      <h1 class="text-5xl md:text-7xl font-display font-black text-white mb-6">
        {pageData?.heroTitle || "Reserva tu mesa en Warynessy"}
      </h1>
      <p class="text-white/60 text-lg max-w-2xl mx-auto font-light">
        Reserva tu mesa online de forma rápida y sencilla.
      </p>
    </Container>
  </section>

  <Section class="bg-matte-black pt-0">
    <Container class="w-full max-w-4xl -mt-8">
      <div class="bg-matte-black rounded-2xl overflow-hidden shadow-2xl border border-white/5">
        <div id="covermanager-widget" class="w-full overflow-hidden">
           <script is:inline src="https://www.covermanager.com/js/iframeResizer.min.js"></script>
           <iframe
             src="https://www.covermanager.com/reservation/module_restaurant/restaurante-warynessy/spanish"
             style="width: 100%; height: 500px; border: none; overflow: hidden;"
             id="restaurante-warynessy"
             title="Reservas"
             allow="payment"
             scrolling="no"
           ></iframe>
           <script is:inline>
             function initReservasIframeResize() {
               if (typeof iFrameResize === 'function') {
                 iFrameResize({
                   log: false,
                   checkOrigin: false,
                   scrolling: false,
                   heightCalculationMethod: 'lowestElement',
                   tolerance: 0
                 }, '#restaurante-warynessy');
               }
             }
             initReservasIframeResize();
             window.addEventListener('load', initReservasIframeResize);
             document.addEventListener('astro:page-load', initReservasIframeResize);
           </script>
        </div>
      </div>

      <div class="mt-12 text-center">
         <p class="text-white/40 mb-2">¿Prefieres llamar?</p>
         {siteSettings?.contact?.phone && (
            <a href={`tel:${siteSettings.contact.phone}`} class="text-2xl font-serif font-bold text-primary hover:text-white transition-colors">
              {siteSettings.contact.phone}
            </a>
         )}
      </div>

      {/* Política de cancelación */}
      <div class="mt-16 p-8 bg-white/5 rounded-2xl border border-white/10">
        <h2 class="text-white font-serif text-xl font-bold mb-6 flex items-center gap-3">
          <span class="material-symbols-outlined text-primary">info</span>
          Política de Cancelación
        </h2>
        <div class="space-y-4 text-white/60 text-sm leading-relaxed">
          <p>
            <strong class="text-white">Avísanos de tu cancelación:</strong> Para cancelar o modificar tu reserva, utiliza el enlace en tu email de confirmación o llámanos directamente.
          </p>
        </div>
      </div>
    </Container>
  </Section>
</MainLayout>
