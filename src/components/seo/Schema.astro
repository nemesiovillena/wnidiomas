---
import { getSiteSettings } from '../../lib/payload-local';

interface Props {
  type?: 'Restaurant' | 'Menu' | 'Article';
  data?: Record<string, any>;
}

const { type = 'Restaurant', data = {} } = Astro.props;

// Fetch base site settings for generic schema
const settings = await getSiteSettings();

let schema: Record<string, any> = {
  "@context": "https://schema.org"
};

if (type === 'Restaurant') {
  schema = {
    ...schema,
    "@type": "Restaurant",
    "name": settings?.title || "Restaurante Warynessy",
    "image": [
      "https://warynessy.com/images/exterior.jpg", // TODO: Usar imagen real del CMS
      "https://warynessy.com/images/interior.jpg"
    ],
    "description": settings?.description,
    "address": {
      "@type": "PostalAddress",
      "streetAddress": settings?.contact?.address,
      "addressLocality": settings?.contact?.city,
      "addressRegion": settings?.contact?.province,
      "postalCode": settings?.contact?.postalCode,
      "addressCountry": "ES"
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": settings?.contact?.coordinates?.lat || 38.6366,
      "longitude": settings?.contact?.coordinates?.lng || -0.865
    },
    "url": "https://warynessy.com",
    "telephone": settings?.contact?.phone,
    "servesCuisine": "Mediterránea, Alta Cocina",
    "priceRange": "€€€",
    "openingHoursSpecification": settings?.openingHours?.map((oh: any) => ({
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": oh.days, // Esto requerirá mapeo si el formato no es estándar de Schema.org
      "opens": "13:00", // Placeholder, idealmente parsear 'hours'
      "closes": "23:00"
    })) || []
  };
}

// Extensible para otros tipos
if (Object.keys(data).length > 0) {
  schema = { ...schema, ...data };
}
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
