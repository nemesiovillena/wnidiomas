---
import { getSiteSettings } from '../../lib/payload-local';

interface Props {
  type?: 'Restaurant' | 'Menu' | 'Article';
  data?: Record<string, any>;
}

const { type = 'Restaurant', data = {} } = Astro.props;

// Fetch base site settings for generic schema
const settings = await getSiteSettings();

let schema: Record<string, any> = {
  "@context": "https://schema.org"
};

const siteUrl = import.meta.env.PUBLIC_SITE_URL || "https://warynessy.com";

if (type === 'Restaurant') {
  const contact = settings?.contact || {};
  
  schema = {
    ...schema,
    "@type": ["Restaurant", "LocalBusiness"],
    "name": settings?.title || "Restaurante Warynessy",
    "image": settings?.logo?.url ? [settings.logo.url] : [],
    "description": settings?.description || "Alta cocina mediterránea",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": contact.address || "",
      "addressLocality": "Villena",
      "addressRegion": "Alicante",
      "postalCode": "03400",
      "addressCountry": "ES"
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": 38.6333,
      "longitude": -0.8667
    },
    "url": siteUrl,
    "telephone": contact.phone || "",
    "servesCuisine": "Mediterránea, Contemporánea",
    "priceRange": "€€€",
    "hasMenu": `${siteUrl}/carta`,
    "acceptsReservations": "true",
    "openingHoursSpecification": settings?.openingHours?.map((oh: any) => ({
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": oh.days,
      "opens": oh.closed ? "00:00" : "13:30",
      "closes": oh.closed ? "00:00" : "23:00"
    })) || []
  };
} else if (type === 'Menu') {
  schema = {
    ...schema,
    "@type": ["Menu", "CreativeWork"],
    "name": data.name || "Nuestra Carta",
    "mainEntityOfPage": `${siteUrl}/carta`,
    "offers": {
      "@type": "Offer",
      "priceCurrency": "EUR"
    }
  };
}

// Extensible para otros tipos
if (Object.keys(data).length > 0) {
  schema = { ...schema, ...data };
}
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
