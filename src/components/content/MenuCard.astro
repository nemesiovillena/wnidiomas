---
import { type Menu } from '../../payload-types';
import ResponsiveImage from '../ui/ResponsiveImage.astro';
import Button from '../ui/Button.astro';

interface Props {
  menu: Menu;
}

const { menu } = Astro.props;
const imageUrl = typeof menu.imagen === 'object' && menu.imagen?.url ? menu.imagen.url : '';

// Extract plain text from Lexical rich text
function extractText(richText: any): string {
  if (!richText?.root?.children) return '';
  function walk(nodes: any[]): string {
    return nodes.map((node: any) => {
      if (node.type === 'text') return node.text || '';
      if (node.children) return walk(node.children);
      return '';
    }).join(' ');
  }
  return walk(richText.root.children).trim();
}

const descriptionText = extractText(menu.descripcion);
---

<div class="group relative overflow-hidden rounded-3xl bg-surface-dark border border-white/5 hover:border-primary/30 transition-all duration-500">
  <div class="aspect-[4/3] overflow-hidden">
    {imageUrl && (
      <ResponsiveImage 
        src={imageUrl} 
        alt={menu.nombre}
        class="h-full w-full transition-transform duration-700 group-hover:scale-110" 
      />
    )}
    <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
    
    <div class="absolute bottom-6 left-6 right-6">
      <span class="inline-block px-3 py-1 bg-primary text-white text-xs font-bold tracking-widest uppercase rounded-full mb-3">
        Menú Especial
      </span>
      <h3 class="text-2xl font-serif font-bold text-white mb-1">
        {menu.nombre}
      </h3>
      <div class="flex items-center gap-2">
        <span class="text-xl font-bold text-white/90">{menu.precio}€</span>
        <span class="text-sm text-white/60">/ persona</span>
      </div>
    </div>
  </div>

  <div class="p-6">
    {descriptionText && (
      <p class="text-sm text-white/70 mb-6 line-clamp-3">
        {descriptionText}
      </p>
    )}

    <div class="flex gap-4">
       <Button variant="outline" size="sm" class="w-full">Ver Detalles</Button>
       <Button variant="primary" size="sm" class="w-full">Reservar</Button>
    </div>
  </div>
</div>
