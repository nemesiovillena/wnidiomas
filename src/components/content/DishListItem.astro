---
import { type Plato } from '../../payload-types';

interface Props {
  plato: Plato;
}

const { plato } = Astro.props;
---

<div
  class="dish-card group flex items-baseline justify-between py-3 border-b border-zinc-100 last:border-b-0 hover:bg-zinc-50 -mx-4 px-4 transition-colors"
  data-alergenos={plato.alergenos?.map((a: any) => typeof a === 'object' ? a.id : a).join(',')}
>
  <div class="flex-1 pr-4">
    <h3 class="font-display text-base font-medium text-zinc-900 group-hover:text-primary transition-colors inline">
      {plato.nombre}
    </h3>
    {plato.descripcion && (
      <span class="text-sm text-zinc-500 ml-2 italic">
        {plato.descripcion}
      </span>
    )}
    {plato.alergenos && plato.alergenos.length > 0 && (
      <span class="inline-flex gap-1 ml-2 align-middle">
        {plato.alergenos.map((alergeno: any) => {
          const PAYLOAD_URL = import.meta.env.PAYLOAD_PUBLIC_SERVER_URL || 'http://localhost:3000';
          const imgUrl = typeof alergeno.imagen === 'object' && alergeno.imagen?.url
            ? (alergeno.imagen.url.startsWith('/') ? `${PAYLOAD_URL}${alergeno.imagen.url}` : alergeno.imagen.url)
            : null;

          return (
            <span
              class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-zinc-100 text-[8px] text-zinc-500 overflow-hidden"
              title={alergeno.nombre}
            >
              {imgUrl ? (
                <img src={imgUrl} alt={alergeno.nombre} class="w-full h-full object-contain p-0.5 opacity-60" />
              ) : (
                alergeno.icono || alergeno.codigo
              )}
            </span>
          );
        })}
      </span>
    )}
  </div>
  <span class="font-medium text-base text-zinc-900 tabular-nums whitespace-nowrap">
    {plato.precio?.toLocaleString('es-ES', { minimumFractionDigits: 2 })} â‚¬
  </span>
</div>
