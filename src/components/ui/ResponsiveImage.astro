---
interface Props {
  src: string;
  alt: string;
  class?: string;
  sizes?: string; // e.g. "(min-width: 1024px) 1024px, 100vw"
  aspectRatio?: string; // e.g. "16/9"
  lazy?: boolean;
}

const { src, alt, class: className = '', sizes = "100vw", aspectRatio, lazy = true } = Astro.props;

// Simple helper to generate dummy placeholder if no src (development)
const BUNNY_URL = import.meta.env.BUNNY_CDN_URL || process.env.BUNNY_CDN_URL;
const PAYLOAD_URL = import.meta.env.PAYLOAD_PUBLIC_SERVER_URL || 'http://localhost:3000';

let imageSrc = src || '/images/placeholder.jpg';

// Si la imagen es de Payload (empieza por /api/media o es relativa)
if (imageSrc.startsWith('/api/media') || (imageSrc.startsWith('/media/') && !imageSrc.startsWith('http'))) {
  if (BUNNY_URL) {
    // En producci√≥n con Bunny CDN
    const cleanPath = imageSrc.replace('/api/media/', '/media/');
    imageSrc = `${BUNNY_URL}${cleanPath}`;
  } else {
    // En desarrollo local, apuntamos directamente al servidor de Payload
    imageSrc = `${PAYLOAD_URL}${imageSrc}`;
  }
}
---

<div class:list={["overflow-hidden bg-white/5", className]} style={aspectRatio ? `aspect-ratio: ${aspectRatio};` : ''}>
  <img
    src={imageSrc}
    alt={alt}
    loading={lazy ? "lazy" : "eager"}
    class="w-full h-full object-cover transition-transform duration-700 hover:scale-105"
  />
</div>
