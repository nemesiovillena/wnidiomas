---
interface Props {
  content: any;
  class?: string;
}

const { content, class: className } = Astro.props;

/**
 * FunciÃ³n recursiva para renderizar los nodos de Lexical
 */
function renderContent(nodes: any[]): string {
  if (!nodes) return "";

  return nodes
    .map((node) => {
      if (node.type === "text") {
        let text = node.text;
        if (node.format & 1) text = `<strong>${text}</strong>`; // Bold
        if (node.format & 2) text = `<em>${text}</em>`; // Italic
        if (node.format & 4) text = `<strike>${text}</strike>`; // Strikethrough
        if (node.format & 8) text = `<u>${text}</u>`; // Underline
        return text;
      }

      if (node.type === "paragraph") {
        return `<p class="mb-4">${renderContent(node.children)}</p>`;
      }

      if (node.type === "heading") {
        const Tag = node.tag || "h3";
        return `<${Tag} class="font-display font-bold mb-4">${renderContent(node.children)}</${Tag}>`;
      }

      if (node.type === "list") {
        const Tag = node.listType === "bullet" ? "ul" : "ol";
        const classNames = node.listType === "bullet" ? "list-disc ml-6 mb-4" : "list-decimal ml-6 mb-4";
        return `<${Tag} class="${classNames}">${renderContent(node.children)}</${Tag}>`;
      }

      if (node.type === "listitem") {
        return `<li>${renderContent(node.children)}</li>`;
      }

      if (node.type === "link") {
        return `<a href="${node.fields.url}" class="text-primary underline hover:no-underline" ${node.fields.newTab ? 'target="_blank" rel="noopener"' : ""}>${renderContent(node.children)}</a>`;
      }

      if (node.children) {
        return renderContent(node.children);
      }

      return "";
    })
    .join("");
}

const html = content?.root ? renderContent(content.root.children) : "";
---

<div class:list={["prose prose-lg dark:prose-invert max-w-none", className]} set:html={html} />
