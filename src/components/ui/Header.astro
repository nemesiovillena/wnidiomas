---
import { getSiteSettings } from '../../lib/payload-local';

// Fetch site settings for logo and title
const siteSettings = await getSiteSettings();

const navLinks = [
  { name: "Carta", href: "/carta" },
  { name: "Menús", href: "/menus" },
  { name: "Reservar mesa", href: "/reservas" },
  { name: "Contacto", href: "/contacto" },
  { name: "Regala gastronomía", href: "/experiencias" },
];
---

<nav 
  id="main-nav" 
  class="fixed top-0 left-0 w-full z-50 flex items-center justify-end px-8 py-2 md:py-3 transition-all duration-500 ease-in-out"
>
  {/* Center: Navigation Links & Actions */}
  <div class="flex items-center gap-8 pointer-events-auto bg-black/20 backdrop-blur-md px-6 py-3 rounded-full border border-white/10">
    
    {/* Logo inside menu */}
    <a href="/" class="group block mr-4">
      <img 
        src="/images/logo-warynessy.svg" 
        alt="Warynessy Logo" 
        class="h-8 w-auto transition-opacity hover:opacity-80" 
      />
    </a>

    <div class="hidden md:flex items-center gap-8">
      {navLinks.map(link => (
        <a 
          href={link.href} 
          class="text-white text-sm font-semibold tracking-widest uppercase hover:text-primary transition-colors"
        >
          {link.name}
        </a>
      ))}
      <div class="h-4 w-px bg-white/30"></div>
    </div>

    {/* Icons/Actions */}
    <div class="flex items-center gap-4">

      <button id="menu-toggle" class="text-white flex items-center justify-center hover:text-primary transition-colors">
        <span class="material-symbols-outlined">menu</span>
      </button>
    </div>
  </div>
</nav>

{/* Mobile Overlay Menu (Inspired by original design but adapted) */}
<div 
  id="mobile-menu" 
  class="fixed inset-0 bg-matte-black/98 backdrop-blur-xl z-[60] flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-500"
>
  <button id="menu-close" class="absolute top-8 right-8 text-white">
    <span class="material-symbols-outlined text-4xl">close</span>
  </button>
  
  <nav class="flex flex-col items-center gap-8 text-center p-6">
    {navLinks.map(link => (
      <a 
        href={link.href} 
        class="mobile-link text-4xl font-display font-medium text-white hover:text-primary transition-colors transform translate-y-4 opacity-0"
      >
        {link.name}
      </a>
    ))}
    <div class="mobile-link transform translate-y-4 opacity-0 mt-4">
      <a href="/reservas" class="inline-block px-10 py-4 bg-accent-red text-white rounded-lg text-lg font-bold tracking-widest uppercase hover:bg-primary transition-transform hover:scale-105 shadow-xl shadow-accent-red/20">
        Reserva Ahora
      </a>
    </div>
  </nav>
</div>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  const nav = document.getElementById('main-nav');
  const menuToggle = document.getElementById('menu-toggle');
  const menuClose = document.getElementById('menu-close');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileLinks = document.querySelectorAll('.mobile-link');
  let isMenuOpen = false;

  // Mobile Menu Logic
  const toggleMenu = (open: boolean) => {
    isMenuOpen = open;
    
    if (open) {
      gsap.to(mobileMenu, { duration: 0.5, opacity: 1, pointerEvents: 'auto', ease: 'power2.out' });
      gsap.to(mobileLinks, { duration: 0.5, y: 0, opacity: 1, stagger: 0.1, delay: 0.2, ease: 'power2.out' });
      document.body.style.overflow = 'hidden';
    } else {
      gsap.to(mobileMenu, { duration: 0.3, opacity: 0, pointerEvents: 'none', ease: 'power2.in' });
      gsap.to(mobileLinks, { duration: 0.3, y: 20, opacity: 0, ease: 'power2.in' });
      document.body.style.overflow = '';
    }
  };

  menuToggle?.addEventListener('click', () => toggleMenu(true));
  menuClose?.addEventListener('click', () => toggleMenu(false));
  
  // Close menu on link click
  mobileLinks.forEach(link => {
    link.addEventListener('click', () => toggleMenu(false));
  });
</script>
