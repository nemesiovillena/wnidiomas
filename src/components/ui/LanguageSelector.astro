---
import { getLocales, locale, getRelativeLocaleUrl } from 'astro:i18n'

const locales = getLocales()
const currentLocale = locale()

// Nombres de idiomas en sus propios idiomas
const localeNames: Record<string, string> = {
    es: 'EspaÃ±ol',
    en: 'English',
    fr: 'FranÃ§ais',
    de: 'Deutsch',
}

// Bandera para cada idioma
const localeFlags: Record<string, string> = {
    es: 'ðŸ‡ªðŸ‡¸',
    en: 'ðŸ‡¬ðŸ‡§',
    fr: 'ðŸ‡«ðŸ‡·',
    de: 'ðŸ‡©ðŸ‡ª',
}
---

<div class="language-selector">
    <select 
        id="language-select"
        class="language-select"
        onchange="changeLanguage(this.value)"
        aria-label="Seleccionar idioma"
    >
        {locales.map((loc) => (
            <option 
                value={loc.code} 
                selected={loc.code === currentLocale}
            >
                {localeFlags[loc.code]} {localeNames[loc.code]}
            </option>
        ))}
    </select>
</div>

<script>
    function changeLanguage(newLocale: string) {
        const currentPath = window.location.pathname;
        const currentSearch = window.location.search;
        const currentHash = window.location.hash;
        
        // Obtener la URL relativa para el nuevo locale
        const newPath = Astro.getRelativeLocaleUrl(newLocale, currentPath);
        
        window.location.href = newPath + currentSearch + currentHash;
    }
</script>

<style>
    .language-selector {
        position: relative;
    }

    .language-select {
        appearance: none;
        background-color: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.375rem;
        padding: 0.5rem 2rem 0.5rem 0.75rem;
        font-size: 0.875rem;
        font-weight: 500;
        color: #1f2937;
        cursor: pointer;
        transition: all 0.2s ease;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.5rem center;
        background-size: 1.25rem;
    }

    .language-select:hover {
        border-color: #9ca3af;
    }

    .language-select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    @media (prefers-color-scheme: dark) {
        .language-select {
            background-color: #1f2937;
            border-color: #374151;
            color: #f9fafb;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239ca3af'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        }

        .language-select:hover {
            border-color: #6b7280;
        }

        .language-select:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
        }
    }
</style>